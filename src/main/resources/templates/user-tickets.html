<!DOCTYPE html>
<html lang="tr" class="loading"
      xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml">

<head th:replace="admin-template :: head"></head>

  <body data-col="2-columns" class=" 2-columns ">
    <div class="wrapper">
      <!--.main-menu(class="#{menuColor} #{menuOpenType}", class=(menuShadow == true ? 'menu-shadow' : ''))-->
        <div th:replace="user-template :: sidebar"></div>


        <div class="main-panel">

        <!-- Navbar (Header) Starts-->
            <nav th:replace="user-template :: header" class="navbar navbar-expand-lg navbar-light bg-faded"></nav>

            <!-- Navbar (Header) Ends-->

        <div class="main-content">
          <div class="content-wrapper"><!--Statistics cards Starts-->
              <div th:replace="admin-template :: messages"></div>

              <section id="extended">
    <div class="row destek">
        <div class="col-sm-12">
            <div class="card">
                <div class="card-header">
                    <h4 style="float: left" class="card-title">Destek Talepleri</h4>
                    <button type="button" style="float: right" class="btn white btn-round gradient-green-tea" data-toggle="modal" data-target="#bootstrap">Destek Talebi Oluştur</button>
                </div>
                <div class="card-body collapse show">
                    <div class="card-block card-dashboard">
                        <table class="table display nowrap table-striped table-bordered scroll-horizontal">
                            <thead>
                                <tr>
                                    <th>Talep No</th>
                                    <th>Konu</th>   
                                    <th>Durum</th>
                                    <th>Son Güncelleme</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="userticket : ${usertickets}">
                                    <td th:text="${userticket.getTicket().getId()}">1</td>
                                    <td th:text="${userticket.getTicket().getSubject()}">İnstagram Türk Takipçi</td>
                                    <td>
                                        <div th:if="${userticket.getTicket().isClosed() == true}"
                                             style="cursor:auto;"
                                             class="btn white btn-round  gradient-green-tea">
                                            Sonlandırıldı
                                        </div>
                                        <div th:if="${userticket.getTicket().isClosed() == false && userticket.isAnswer() == true}"
                                             style="cursor:auto;"
                                             class="btn white btn-round  gradient-mini">
                                            Yanıtlandı
                                        </div>
                                        <div th:if="${userticket.getTicket().isClosed() == false && userticket.isAnswer() == false}"
                                             style="cursor:auto;"
                                             class="btn white btn-round  gradient-nepal">
                                            Bekleniyor
                                        </div>
                                    </td>
                                    <td th:text="${userticket.getLastChange()}"></td>
                                    <td>
                                        <a th:href="@{'/user/tickets/detail/' + ${userticket.getTicket().getId()}}" class="btn white btn-round gradient-dawn">
                                            Detay
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Talep No</th>
                                    <th>Konu</th>   
                                    <th>Durum</th>
                                    <th>Son Güncelleme</th>
                                    <th></th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
          </div>
        </div>


      </div>
    </div>
    <script th:src="@{/vendors/js/core/jquery-3.2.1.min.js}" type="text/javascript"></script>
    <script th:src="@{/vendors/js/core/popper.min.js}" type="text/javascript"></script>
    <script th:src="@{/vendors/js/core/bootstrap.min.js}" type="text/javascript"></script>
    <script th:src="@{/vendors/js/perfect-scrollbar.jquery.min.js}" type="text/javascript"></script>
    <script th:src="@{/vendors/js/prism.min.js}" type="text/javascript"></script>
    <script th:src="@{/vendors/js/jquery.matchHeight-min.js}" type="text/javascript"></script>
    <script th:src="@{/vendors/js/screenfull.min.js}" type="text/javascript"></script>
    <script th:src="@{/vendors/js/pace/pace.min.js}" type="text/javascript"></script>
    <script th:src="@{/js/app-sidebar.js}" type="text/javascript"></script>
    <script th:src="@{/js/notification-sidebar.js}" type="text/javascript"></script>
    <script th:src="@{/js/customizer.js}" type="text/javascript"></script>
    <script th:src="@{/vendors/js/datatable/datatables.min.js}" type="text/javascript"></script>
    <script th:src="@{/js/data-tables/datatable-basic.js}" type="text/javascript"></script>

      <div class="modal fade text-left" id="bootstrap" tabindex="-1" role="dialog" aria-labelledby="DestekTalebiModals" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                      <h3 class="modal-title" id="DestekTalebiModals"> Destek Talebi Oluştur</h3>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                      </div>
                      <form id="form" class="form" th:action="@{/user/tickets}" th:object="${create_ticket_form}" method="post">
                          <div class="modal-body">
                              <div class="form-group">
                                    <label for="subject">Konu</label>
                                    <select th:field="*{subject}" id="subject" name="priority" class="form-control" data-toggle="tooltip" data-trigger="hover" data-placement="top" data-title="Priority">
                                        <option value="order">Sipariş</option>
                                        <option value="other">Diğer Konular</option>
                                    </select>
                              </div>
                              <div class="form-group" id="orderNoDiv">
                                    <label for="orderNo">Sipariş No</label>
                                    <input th:field="*{orderNumber}" type="number" class="form-control" id="orderNo" placeholder="Sipariş numarasını giriniz.">
                              </div>
                              <div class="form-group" id="customSubjectDiv">
                                  <label for="customsubject">Konu Başlığı</label>
                                  <input autocomplete="off" th:field="*{customSubject}" type="text" class="form-control" id="customsubject" placeholder="Konu başlığı">
                              </div>
                              <div class="form-group">
                                    <label for="message">Mesajınız</label>
                                    <textarea id="message" th:field="*{message}" class="form-control" rows="3" placeholder="Mesajınızı yazın"></textarea>
                              </div>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-block btn-raised gradient-flickr white" data-dismiss="modal">Kapat</button>
                            <button type="submit" class="btn btn-block btn-raised gradient-mint white"><i class="icon-cursor"></i>  Bileti Gönder</button>
                          </div>
                      </form>
                    </div>
                    </div>
                  </div>

    <script>
        window.onload = function () {
            selectControl();
        };

        $('#subject').change(
            function () {
                selectControl();
            }
        );

        selectControl = function () {
            if ($('#subject').val() === 'order'){
                $('#customSubjectDiv').hide();
                $('#orderNoDiv').show();
            } else if ($('#subject').val() === 'other') {
                $('#customSubjectDiv').show();
                $('#orderNoDiv').hide();
            }
        }

        $('#form').submit(
            function (e) {
                var messageIsEmpty = $('#message').val() === '';
                var isEmptyArea = false;
                
                if ($('#subject').val() === 'order' && $('#orderNo').val() === ''){
                    isEmptyArea = true;
                } else if ($('#subject').val() === 'other' && $('#customsubject').val() === '') {
                    isEmptyArea = true
                }
                
                if (messageIsEmpty || isEmptyArea){
                    alert("Tüm alanları doldurmalısınız !");
                    e.preventDefault();
                }
            }
        );

    </script>
  </body>

</html>